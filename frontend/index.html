<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFinds - Browse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.0.16/24/outline/hero-icons.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Times New Roman', serif; background-color: #f8fafc; }
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #34d399; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .sidebar-link { @apply flex items-center px-4 py-2 text-gray-700 rounded-md hover:bg-emerald-100 hover:text-emerald-700; }
        .sidebar-link.active { @apply bg-emerald-100 text-emerald-700 font-bold; }
    </style>
</head>
<body class="text-gray-800">

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg flex flex-col">
            <div class="flex items-center justify-center p-4 border-b">
                <img src="log.jpg" alt="Logo" class="h-10 w-10 mr-2">
                <h1 class="text-xl font-bold text-emerald-600">EcoFinds</h1>
            </div>
            <nav class="flex-grow px-4 py-4 space-y-2">
                <a href="index.html" class="sidebar-link active">
                    <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    Browse
                </a>
                <a href="#" class="sidebar-link">
                    <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/></svg>
                    My Products
                </a>
                <a href="add-product.html" class="sidebar-link">
                    <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    Add Product
                </a>
                <a href="#" class="sidebar-link">
                     <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    Cart
                </a>
                <a href="#" class="sidebar-link">
                     <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                    Purchase History
                </a>
                 <a href="#" class="sidebar-link">
                     <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    Profile
                </a>
            </nav>
            <div class="p-4 border-t">
                <!-- User profile section can go here -->
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-emerald-200 flex items-center justify-center font-bold text-emerald-700">TS</div>
                    <div class="ml-3">
                        <p class="font-semibold text-sm">Test User</p>
                        <p class="text-xs text-gray-500">Welcome</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white shadow-sm p-4">
                 <h2 class="text-2xl font-bold">Discover Sustainable Finds</h2>
                 <p class="text-gray-500">Shop pre-loved items and reduce your environmental impact</p>
            </header>
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                 <!-- Controls: Search & Filter -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap gap-4 items-center">
                    <div class="flex-grow min-w-[300px] relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>
                        </div>
                        <input type="search" id="search-input" placeholder="Search for products..." class="p-2 pl-10 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 outline-none">
                    </div>
                    <div>
                        <select id="category-filter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 outline-none">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                     <div>
                        <select id="sort-filter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 outline-none">
                            <option value="name-asc">Sort by Name (A-Z)</option>
                            <option value="name-desc">Sort by Name (Z-A)</option>
                            <option value="price-asc">Sort by Price (Low-High)</option>
                            <option value="price-desc">Sort by Price (High-Low)</option>
                        </select>
                    </div>
                </div>

                <!-- Product Grid -->
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                <div id="loading-indicator" class="flex justify-center mt-8 hidden"><div class="loader"></div></div>
                <div id="message-area" class="text-center text-gray-500 mt-8 hidden"></div>
            </main>
        </div>
    </div>
    
    <!-- Template remains the same -->
    <template id="product-card-template">
        <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">
            <img data-template="image" src="https://via.placeholder.com/300" alt="Product Image" class="w-full h-48 object-cover">
            <div class="p-4">
                <div class="flex justify-between items-start">
                    <h3 data-template="name" class="text-lg font-bold mb-1">Product Name</h3>
                    <span data-template="condition" class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">condition</span>
                </div>
                <p data-template="brand" class="text-sm text-gray-500 mb-2">Brand</p>
                <div class="text-xl font-bold text-emerald-600 text-right">
                    $<span data-template="price">0.00</span>
                </div>
            </div>
        </div>
    </template>

    <script>
        // --- The JavaScript is almost identical, but we update the template rendering ---
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'http://127.0.0.1:8000/api';
            const productGrid = document.getElementById('product-grid');
            const searchInput = document.getElementById('search-input');
            const categoryFilter = document.getElementById('category-filter');
            const sortFilter = document.getElementById('sort-filter');
            const productCardTemplate = document.getElementById('product-card-template');
            const loadingIndicator = document.getElementById('loading-indicator');
            const messageArea = document.getElementById('message-area');

            async function fetchAndRenderProducts() {
                loadingIndicator.classList.remove('hidden');
                messageArea.classList.add('hidden');
                productGrid.innerHTML = '';
                const params = new URLSearchParams();
                if (searchInput.value) params.set('search', searchInput.value);
                if (categoryFilter.value) params.set('category_id', categoryFilter.value);
                const [sortBy, sortDir] = sortFilter.value.split('-');
                params.set('sort_by', sortBy);
                params.set('sort_direction', sortDir);

                try {
                    const response = await fetch(`${API_BASE_URL}/products?${params.toString()}`);
                    const products = await response.json();
                    if (products.length === 0) {
                        messageArea.textContent = 'No products found.';
                        messageArea.classList.remove('hidden');
                    } else {
                        products.forEach(product => {
                            const card = productCardTemplate.content.cloneNode(true);
                            card.querySelector('[data-template="name"]').textContent = product.name;
                            card.querySelector('[data-template="brand"]').textContent = product.brand || 'N/A';
                            card.querySelector('[data-template="condition"]').textContent = product.condition || 'N/A';
                            card.querySelector('[data-template="price"]').textContent = product.price.toFixed(2);
                            if (product.image_url) card.querySelector('[data-template="image"]').src = product.image_url;
                            productGrid.appendChild(card);
                        });
                    }
                } catch (error) {
                    messageArea.textContent = 'Failed to load products.';
                    messageArea.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }
            async function fetchCategories() {
                try {
                    const response = await fetch(`${API_BASE_URL}/categories`);
                    const categories = await response.json();
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        categoryFilter.appendChild(option);
                    });
                } catch (error) { console.error('Error fetching categories:', error); }
            }
            searchInput.addEventListener('input', () => setTimeout(fetchAndRenderProducts, 300)); // Debounce search
            categoryFilter.addEventListener('change', fetchAndRenderProducts);
            sortFilter.addEventListener('change', fetchAndRenderProducts);
            fetchCategories();
            fetchAndRenderProducts();
        });
    </script>
</body>
</html>